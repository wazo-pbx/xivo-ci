#!/usr/bin/env python

import argparse
import urllib2
import json

TRAVIS_API_URL = 'https://api.travis-ci.org/repositories/xivo-pbx'


def is_good(infos_package):
    status = infos_package['branch']['state']
    return status not in ('failed', 'errored')


def main():
    parser = argparse.ArgumentParser()
    parser.add_argument('package', help='Package name to test')

    args = parser.parse_args()

    try:
        response = urllib2.urlopen('%s/xivo-%s/branches/master' % (TRAVIS_API_URL, args.package))
    except urllib2.HTTPError:
        print 'Error: package %s does not exist on travis' % args.package
    else:
        infos_package = json.load(response)

        if is_good(infos_package):
            print 'OK'
        else:
            print 'KO'


if __name__ == '__main__':
    main()
