#!/bin/bash

package_name="$1"
package_path="${2:-.}"

usage() {
    echo "Usage: $0 package_name [module_path]" >&2
    exit 1
}

if [ $# -lt 1 ]; then
    usage
fi

nosetests --cover-package=$package_name --with-xunit --with-coverage --cover-xml --cover-erase $package_path/$package_name
exit_code=$?

pep8 --repeat --ignore E320,E501 $package_path/$package_name > pep8.txt
PYTHONPATH=$package_path:$PYTHONPATH pylint-patcher --rcfile=/usr/share/xivo-ci/pylintrc $package_name > pylint.txt

exit $exit_code
