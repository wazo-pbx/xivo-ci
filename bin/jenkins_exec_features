#!/bin/bash

ACCEPTANCE_PATH="/data/xivo-acceptance"
FEATURE_NAME=$(echo $JOB_NAME | sed 's/acceptance_//g')

export PYTHONIOENCODING=UTF-8
export PYTHONPATH=$ACCEPTANCE_PATH

if [ $FEATURE_NAME == 'post_wizard' ]; then
    python ${ACCEPTANCE_PATH}/utils/prerequisite.py
fi

cd $ACCEPTANCE_PATH
git pull
cp -r features/$FEATURE_NAME $WORKSPACE

cd $WORKSPACE
lettuce $FEATURE_NAME --with-xunit --verbosity=3 --xunit-file=xunit-tests.xml
cp xunit-tests.xml /data/test_results/$JOB_NAME.xml
